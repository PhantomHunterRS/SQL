База данных «Геодата»:
-- 1.1. Сделать запрос, в котором мы выберем все данные о городе – регион, страна.

CREATE 
    ALGORITHM = UNDEFINED 
    DEFINER = `root`@`localhost` 
    SQL SECURITY DEFINER
VIEW `geo_city` AS
    SELECT 
        `_cities`.`title` AS `CityName`,
        `_countries`.`title` AS `CountryName`,
        `_regions`.`title` AS `RegionName`
    FROM
        ((`_cities`
        JOIN `_countries` ON ((`_cities`.`country_id` = `_countries`.`country_id`)))
        JOIN `_regions` ON ((`_cities`.`region_id` = `_regions`.`region_id`)))
    WHERE
        (`_cities`.`title` = 'Москва')

-- 1.2. Выбрать все города из Московской области.

USE `geodata`;
CREATE  OR REPLACE VIEW `MoscowRegions` AS
    SELECT 
        _cities.title AS City, _regions.title AS Region
    FROM
        _cities
            JOIN
        _regions ON _cities.region_id = _regions.region_id
    WHERE
        _regions.title = 'Московская область';

База данных «Сотрудники»:
-- 1.1. Выбрать среднюю зарплату по отделам.
USE `employees`;
CREATE  OR REPLACE VIEW `Salary Department` AS
    SELECT 
        dept_name AS Department, AVG(salary) AS AVG_SALARY
    FROM
        salaries
            JOIN
        dept_emp ON salaries.emp_no = dept_emp.emp_no
            JOIN
        departments ON departments.dept_no = dept_emp.dept_no
    GROUP BY dept_name;

--1.2. Выбрать максимальную зарплату у сотрудника.
USE `employees`;
CREATE  OR REPLACE VIEW `The_Best_Salary` AS
    SELECT 
        CONCAT(first_name, ',', last_name) AS FullName,
        MAX(S.salary) AS MaxSalary
    FROM
        employees AS E
            JOIN
        salaries AS S ON E.emp_no = S.emp_no
    GROUP BY FullName
    ORDER BY MaxSalary DESC
    LIMIT 1;

--1.4. Посчитать количество сотрудников во всех отделах.
USE `employees`;
CREATE  OR REPLACE VIEW `CountEmployeesInDepartment` AS
    SELECT 
        departments.dept_name, COUNT(*) AS CountEmployees
    FROM
        dept_emp
            JOIN
        departments ON dept_emp.dept_no = departments.dept_no
    WHERE
        dept_emp.to_date = '9999-01-01'
    GROUP BY departments.dept_name;

--1.5. Найти количество сотрудников в отделах и посмотреть, сколько всего денег получает отдел.
USE `employees`;
CREATE  OR REPLACE VIEW `Department_Salaries` AS
SELECT 
    departments.dept_name,
    COUNT(*) AS CountEmployees,
    SUM(salary) AS SumSalaryDep
FROM
    dept_emp
        JOIN
    departments ON departments.dept_no = dept_emp.dept_no
        JOIN
    salaries ON salaries.emp_no = dept_emp.emp_no
WHERE
    salaries.to_date = '9999-01-01'
GROUP BY departments.dept_name;
**************************************************
--2. FUNCTION
**************************************************
USE `employees`;
DROP function IF EXISTS `ManagerDeptNo`;

DELIMITER $$
USE `employees`$$
CREATE FUNCTION `ManagerDeptNo` (firstName varchar(14),lastName varchar(16))
RETURNS char(4)
reads sql data
BEGIN
DECLARE managerNo char(4);
SET managerNo = (SELECT 
    dept_manager.dept_no AS ManagerDeptNumber
FROM
    dept_manager
        JOIN
    dept_emp ON dept_manager.dept_no = dept_emp.dept_no
        JOIN
    employees ON dept_emp.emp_no = employees.emp_no
WHERE
    employees.first_name = firstName
        AND employees.last_name = lastName
        LIMIT 1);
RETURN managerNo;
END$$

DELIMITER ;

-- 3 

